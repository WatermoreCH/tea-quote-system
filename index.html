<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒ¶åŒ¯å…¬å¸ | å°ˆæ¥­èŒ¶åŒ… OEM å®¢è£½åŒ–å ±åƒ¹ç³»çµ±</title>
    <script src="https://www.google.com/recaptcha/api.js?render=6LcivkQsAAAAAHwFJqqT6KHphabDFuYsm2d8t915"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f4f6f3; scroll-behavior: smooth; }
        .hero-spotlight {
            background: radial-gradient(circle at 20% 30%, rgba(197, 160, 89, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(197, 160, 89, 0.15) 0%, transparent 40%),
                        #1A302B;
        }
        .text-glow-gold { text-shadow: 0 0 30px rgba(197, 160, 89, 0.6); }
        .gold-value-block {
            background: linear-gradient(145deg, #D4B475 0%, #C5A059 100%);
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.4), 0 20px 40px -10px rgba(197, 160, 89, 0.4);
        }
        .cta-destructive {
            background: linear-gradient(180deg, #FFD98E 0%, #C5A059 100%);
            box-shadow: 0 15px 35px -5px rgba(197, 160, 89, 0.6), 0 8px 0 #8E713A;
            transition: all 0.15s ease-out;
        }
        .cta-destructive:hover { transform: translateY(-4px); box-shadow: 0 20px 40px -5px rgba(197, 160, 89, 0.7), 0 10px 0 #8E713A; }
        .cta-destructive:active { transform: translateY(4px); box-shadow: 0 0 0 #8E713A; }
        .card-active { border: 4px solid #1A302B !important; background-color: #fffdf5 !important; box-shadow: 0 15px 30px -5px rgba(197, 160, 89, 0.3) !important; color: #1A302B !important; z-index: 20; position: relative; }
        .hover-zoom { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .hover-zoom:hover { transform: scale(1.05); filter: brightness(1.05); }
    </style>
</head>
<body x-data="quoteSystem()" class="text-slate-900 leading-relaxed text-base md:text-lg">

    <header class="hero-spotlight text-white py-16 md:py-32 px-6 text-center relative overflow-hidden">
        <div class="max-w-5xl mx-auto relative z-10 text-center">
            <div class="flex justify-center gap-3 mb-8 opacity-90 flex-wrap text-center">
                <span class="bg-white/10 px-4 py-1.5 rounded-full text-sm font-bold border border-white/20 whitespace-nowrap">ISO 22000 èªè­‰å·¥å» </span>
                <span class="bg-white/10 px-4 py-1.5 rounded-full text-sm font-bold border border-white/20 whitespace-nowrap">HACCP é£Ÿå“å®‰å…¨èªè­‰</span>
                <span class="bg-white/10 px-4 py-1.5 rounded-full text-sm font-bold border border-white/20 whitespace-nowrap">FDA é£Ÿå“è¨­æ–½è¨»å†Š</span>
            </div>
            <h1 class="text-3xl md:text-7xl font-black mb-8 leading-tight tracking-tighter break-words text-center">
                èŒ¶åŒ…å®¢è£½åŒ– <span class="text-[#C5A059] text-glow-gold">æ­£å¼å ±åƒ¹</span> ç³»çµ±
            </h1>
            <p class="text-base md:text-2xl text-slate-300 font-medium max-w-3xl mx-auto leading-relaxed break-words px-4 text-center">
                çœç•¥ç„¡æ•ˆè©¢å•ï¼Œå¾é€™è£¡ç²å–ä¸€ä»½<br class="hidden md:block">
                <span class="text-white border-b-4 border-[#C5A059] pb-1 font-black">å…·å‚™æ¡è³¼æ¨™æº–èˆ‡æ³•å¾‹æ•ˆåŠ›çš„æ­£å¼å ±åƒ¹å–®ã€‚</span>
            </p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto py-12 px-4 md:px-6">
        <section class="mb-16">
            <div class="text-center mb-10">
                <h2 class="text-2xl md:text-4xl font-black text-slate-900">æ­¥é©Ÿä¸€ï¼šæ‚¨çš„å“ç‰Œç¶“ç‡Ÿéšæ®µ</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <template x-for="stage in stages" :key="stage.id">
                    <button @click="selectStage(stage)"
                        :class="selectedStageId === stage.id ? 'card-active scale-105' : 'bg-white border border-gray-200 opacity-80 md:opacity-100'"
                        class="p-8 rounded-[2rem] text-left transition-all relative group flex flex-col items-center overflow-hidden shadow-sm text-center">
                        <div x-show="stage.recommended" class="absolute top-0 right-0 bg-[#C5A059] text-[#1A302B] text-xs px-4 py-1.5 rounded-bl-2xl font-black">æ¨è–¦æ–¹æ¡ˆ</div>
                        <div class="text-5xl mb-6" x-text="stage.icon"></div>
                        <h3 class="text-xl md:text-2xl font-black mb-3" x-text="stage.name"></h3>
                        <p class="text-slate-600 text-base md:text-lg leading-relaxed break-words text-center" x-text="stage.desc"></p>
                    </button>
                </template>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 items-start">
            <div class="lg:col-span-7 space-y-10">
                <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <h2 class="text-xl md:text-2xl font-black mb-8 flex items-center">
                        <span class="bg-slate-900 text-white w-8 h-8 rounded-full inline-flex items-center justify-center mr-4 text-sm font-black text-center">02</span>
                        é¸æ“‡å®¢è£½ç­‰ç´š
                    </h2>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-3 text-center">
                        <template x-for="plan in allPlans" :key="plan.id">
                            <div class="relative">
                                <button @click="selectPlan(plan)"
                                    :class="selectedPlanId === plan.id ? 'card-active shadow-2xl scale-105 border-slate-900' : (plan.id === 'C' ? 'border-[#C5A059] bg-[#FFFDF5]' : getPlanBg(plan.id)) + ' border-transparent'"
                                    class="w-full py-6 px-1 rounded-xl transition-all text-center text-sm md:text-base break-words border-4 flex flex-col items-center justify-center min-h-[130px]">
                                    <div class="text-[10px] md:text-xs opacity-80 font-black mb-1 uppercase">æ–¹æ¡ˆ <span x-text="plan.id"></span></div>
                                    <div class="font-black leading-tight" x-text="plan.name"></div>
                                    <div class="text-[10px] md:text-xs mt-2 opacity-80 font-bold">èµ·è¨‚: <span x-text="plan.moq"></span></div>
                                </button>
                                <template x-if="plan.id === 'C'">
                                    <div class="absolute -bottom-3 left-1/2 -translate-x-1/2 bg-[#C5A059] text-[#1A302B] text-[10px] md:text-xs px-3 py-1 rounded-full font-black shadow-md whitespace-nowrap z-10 text-center">æœ€å—æ­¡è¿ â­</div>
                                </template>
                            </div>
                        </template>
                    </div>
                </div>

                <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <h2 class="text-xl md:text-2xl font-black mb-2 flex items-center">
                        <span class="bg-slate-900 text-white w-8 h-8 rounded-full inline-flex items-center justify-center mr-4 text-sm font-black text-center">03</span>
                        èŒ¶åŒ…å…§è¢‹æè³ª
                    </h2>
                    <p class="text-slate-400 text-sm md:text-base mb-8 ml-12 font-bold text-center">æ¨™æº–è¦æ ¼ï¼š5.8 Ã— 5.8 å…¬åˆ† (æ‰€æœ‰æ–¹æ¡ˆå›ºå®š)</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 ml-0 md:ml-12">
                        <template x-for="mat in materials" :key="mat.name">
                            <button @click="selectedMaterial = mat"
                                :class="selectedMaterial.name === mat.name ? 'card-active ring-2' : getMatBg(mat.type) + ' border-transparent text-slate-700'"
                                class="p-5 rounded-2xl text-left transition-all border-4 flex flex-col justify-between min-h-[110px]">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="font-black text-base md:text-lg" x-text="mat.name"></span>
                                    <span :class="selectedMaterial.name === mat.name ? 'bg-slate-900 text-white' : 'bg-white/50 text-slate-800'" class="text-xs px-2 py-0.5 rounded font-black uppercase text-center" x-text="mat.type"></span>
                                </div>
                                <div class="text-[#1A302B] font-black text-lg md:text-xl">+ æ¯åŒ… <span x-text="mat.surcharge.toFixed(1)"></span> å…ƒ</div>
                            </button>
                        </template>
                    </div>
                </div>

                <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <h2 class="text-xl md:text-2xl font-black mb-8 flex items-center">
                        <span class="bg-slate-900 text-white w-8 h-8 rounded-full inline-flex items-center justify-center mr-4 text-sm font-black text-center">04</span>
                        åŒ…è£çµæ§‹èªªæ˜
                    </h2>
                    <div class="ml-0 md:ml-12">
                        <div x-show="!canBox" class="bg-slate-50 border-4 border-dotted border-slate-200 py-12 rounded-3xl text-center px-4">
                            <p class="text-slate-400 font-black text-base md:text-lg text-center">æ­¤æ–¹æ¡ˆæœªé–‹æ”¾ç›’è£å®¢è£½ï¼Œ<br>è«‹å‡ç´šæ–¹æ¡ˆ C / D è§£é–</p>
                        </div>
                        <div x-show="canBox" class="bg-slate-900 text-white p-8 rounded-[2.5rem] flex flex-col md:flex-row gap-8 items-center text-center">
                            <div class="flex-1 space-y-4">
                                <div class="bg-[#C5A059] text-[#1A302B] px-4 py-1.5 rounded-full text-sm font-black inline-block uppercase tracking-widest text-center" x-text="boxName"></div>
                                <ul class="text-sm md:text-lg space-y-2 text-slate-400 font-medium text-center">
                                    <li>â€¢ å°ºå¯¸ï¼š10 Ã— 10 Ã— 11.5 å…¬åˆ†</li>
                                    <li>â€¢ æè³ªï¼šç™½å¡ 45T / éœ§è†œè™•ç†</li>
                                    <li>â€¢ å®¹é‡ï¼šæ¯ç›’ 15 å…¥</li>
                                </ul>
                            </div>
                            <div class="flex flex-col items-center gap-3">
                                <a href="https://www.bpbpack.com.tw/products/3a14-16006" target="_blank" class="block bg-white/10 p-2 rounded-3xl border border-white/20 hover-zoom shadow-2xl group relative overflow-hidden">
                                    <div class="w-32 h-32 md:w-40 md:h-40 bg-white rounded-2xl flex items-center justify-center p-2">
                                        <img src="https://www.bpbpack.com.tw/archive/products/item/3a14-16006/3a14-16006_01.jpg" alt="å¤–ç›’çµæ§‹" class="w-full h-full object-contain">
                                    </div>
                                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-2xl text-center">
                                        <span class="text-[10px] font-black text-white px-2 py-1 border border-white rounded text-center">æŸ¥çœ‹è©³ç´°è¦æ ¼</span>
                                    </div>
                                </a>
                                <p class="text-[10px] md:text-xs text-[#C5A059] font-black tracking-widest text-center">ç¬¬ä¸‰æ–¹å°ˆæ¥­åŒ…æä¾›æ‡‰å•†è¦æ ¼é </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <h2 class="text-xl md:text-2xl font-black mb-8 flex items-center">
                        <span class="bg-slate-900 text-white w-8 h-8 rounded-full inline-flex items-center justify-center mr-4 text-sm font-black text-center text-center">05</span>
                        è¨­å®šè¨‚è³¼æ•¸é‡
                    </h2>
                    <div class="ml-0 md:ml-12">
                        <div class="grid grid-cols-3 md:grid-cols-5 gap-3 mb-10 text-center">
                            <template x-for="qty in qtyOptions" :key="qty">
                                <button @click="quantity = qty"
                                    x-show="qty >= minMoq"
                                    :class="quantity === qty ? 'bg-slate-900 text-white font-black shadow-2xl' : 'bg-slate-100 text-slate-400 font-bold'"
                                    class="py-4 text-base md:text-lg rounded-xl transition-all shadow-sm text-center"
                                    x-text="qty.toLocaleString()">
                                </button>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <aside class="lg:col-span-5 sticky top-8">
                <div class="bg-[#1A302B] rounded-[2.5rem] p-8 md:p-12 text-white shadow-2xl relative overflow-hidden">
                    <h3 class="text-xs font-black tracking-[0.3em] text-[#C5A059] mb-10 uppercase text-center">å ±åƒ¹æ˜ç´°ç¸½çµ</h3>
                    
                    <div class="space-y-6 text-base md:text-lg mb-10 font-medium">
                        <div class="flex justify-between border-b border-white/10 pb-4">
                            <span class="opacity-60 shrink-0">å·²é¸å®¢è£½æ–¹æ¡ˆ</span>
                            <span class="font-black text-right" x-text="'æ–¹æ¡ˆ ' + selectedPlanId + 'ï½œ' + selectedPlan.name"></span>
                        </div>
                        <div class="flex justify-between border-b border-white/10 pb-4">
                            <span class="opacity-60">å…§è¢‹æè³ªåŠ åƒ¹</span>
                            <span class="text-[#C5A059] font-black text-right" x-text="'+ æ¯åŒ… ' + selectedMaterial.surcharge.toFixed(1) + ' å…ƒ'"></span>
                        </div>
                    </div>

                    <div class="gold-value-block p-8 md:p-10 rounded-[2.5rem] text-[#1A302B] mb-10 text-center">
                        <div class="flex justify-between items-end mb-8">
                            <span class="text-sm font-black uppercase tracking-widest opacity-80 text-left">æœ€çµ‚å–®åƒ¹</span>
                            <div class="text-right">
                                <span class="text-3xl md:text-6xl font-black tracking-tighter" x-text="'NT$ ' + finalUnitPrice"></span>
                            </div>
                        </div>
                        <div class="pt-8 border-t border-[#1A302B]/20 text-center">
                            <div class="text-sm font-black uppercase tracking-widest opacity-80 mb-2">å°ˆæ¡ˆé ä¼°ç¸½é‡‘é¡</div>
                            <div class="text-4xl md:text-6xl font-black tracking-tighter">NT$ <span x-text="totalPrice.toLocaleString()"></span></div>
                        </div>
                    </div>

                    <button @click="showForm = true; $nextTick(() => document.getElementById('form-section').scrollIntoView({behavior:'smooth'}))" 
                        class="cta-destructive w-full text-[#1A302B] py-6 md:py-8 rounded-[2.5rem] font-black text-xl md:text-3xl tracking-widest uppercase mb-4 text-center">
                        ç”¢å‡ºæ­£å¼å ±åƒ¹å–®
                    </button>
                </div>
            </aside>
        </div>

        <section id="form-section" x-show="showForm" x-transition class="mt-24 max-w-4xl mx-auto">
            <div class="bg-[#1A302B] text-white p-8 md:p-12 rounded-t-[4rem] border-b border-[#C5A059]/30 shadow-2xl text-center">
                <p class="text-lg md:text-2xl font-black leading-relaxed tracking-tighter">
                    æ‚¨ç›®å‰è¨­å®šçš„è¦æ ¼ï¼Œå°‡ä½œç‚ºæ­£å¼å ±åƒ¹èˆ‡ç”Ÿç”¢ä¾æ“šã€‚
                </p>
            </div>

            <div class="bg-white p-10 md:p-20 rounded-b-[4rem] shadow-2xl border border-slate-100">
                <form @submit.prevent="handleSubmit" class="space-y-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-4">
                            <label class="text-base md:text-lg font-black text-slate-800">å…¬å¸æŠ¬é ­ / çµ±ä¸€ç·¨è™Ÿ *</label>
                            <input type="text" x-model="formData.company" required class="w-full px-8 py-5 bg-slate-50 border-none rounded-2xl font-bold" placeholder="å…¬å¸åç¨±">
                        </div>
                        <div class="space-y-4">
                            <label class="text-base md:text-lg font-black text-slate-800">è¯çµ¡äººå§“å *</label>
                            <input type="text" x-model="formData.name" required class="w-full px-8 py-5 bg-slate-50 border-none rounded-2xl font-bold" placeholder="æ‚¨çš„å§“å">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                        <div class="space-y-4">
                            <label class="text-base md:text-lg font-black text-slate-800">æ¥æ”¶å ±åƒ¹ä¹‹é›»å­ä¿¡ç®± *</label>
                            <input type="email" x-model="formData.email" required class="w-full px-8 py-5 bg-slate-50 border-none rounded-2xl font-bold" placeholder="Email">
                        </div>
                        <div class="space-y-4">
                            <label class="text-base md:text-lg font-black text-slate-800">è¯çµ¡é›»è©±æˆ– LINE ID *</label>
                            <input type="text" x-model="formData.contact" required class="w-full px-8 py-5 bg-slate-50 border-none rounded-2xl font-bold" placeholder="è¯çµ¡è³‡è¨Š">
                        </div>
                    </div>
                    
                    <button type="submit" :disabled="loading" class="w-full bg-slate-900 text-white py-8 rounded-[2.5rem] font-black text-2xl md:text-4xl shadow-2xl flex justify-center items-center">
                        <span x-show="!loading">ç¢ºèªè¦æ ¼ä¸¦å¯„é€å ±åƒ¹å–®</span>
                        <span x-show="loading" class="flex items-center">
                            <svg class="animate-spin h-10 w-10 mr-6 text-[#C5A059]" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            æ­£åœ¨ç”¢å‡º PDF ä¸¦å¯„é€...
                        </span>
                    </button>
                </form>
            </div>
        </section>

        <section id="upload-section" class="mt-12 max-w-4xl mx-auto pb-32">
            <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border-4 border-dashed border-[#C5A059]/30">
                <h2 class="text-xl font-black mb-4 flex items-center">
                    <span class="bg-[#C5A059] text-[#1A302B] w-8 h-8 rounded-full inline-flex items-center justify-center mr-4 text-sm font-black">06</span>
                    è¨­è¨ˆæª”æ¡ˆå®‰å…¨ä¸Šå‚³
                </h2>
                <div x-show="uploadStep === 'email'" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" x-model="quoteNumber" class="w-full px-6 py-4 bg-slate-50 rounded-xl" placeholder="æ­£å¼å ±åƒ¹ç·¨è™Ÿ">
                        <input type="email" x-model="uploadEmail" class="w-full px-6 py-4 bg-slate-50 rounded-xl" placeholder="åŸå ±åƒ¹ Email">
                    </div>
                    <button @click="sendOTP()" :disabled="isVerifying" class="w-full bg-slate-900 text-white py-5 rounded-xl font-black">ç™¼é€é©—è­‰ç¢¼</button>
                </div>

                <div x-show="uploadStep === 'otp'" class="text-center bg-slate-50 p-6 rounded-2xl" x-cloak>
                    <p class="mb-4 font-bold text-slate-600">é©—è­‰ç¢¼å·²å¯„å‡ºè‡³ä¿¡ç®±</p>
                    <div class="flex gap-4 max-w-sm mx-auto">
                        <input type="text" x-model="otpInput" class="flex-1 px-6 py-4 bg-white border-2 rounded-xl text-center text-2xl font-black">
                        <button @click="verifyOTP()" class="bg-[#C5A059] px-8 rounded-xl font-black">é©—è­‰</button>
                    </div>
                </div>

                <div x-show="uploadStep === 'upload'" class="py-4 text-center" x-cloak>
                    <label class="cursor-pointer block border-4 border-dotted rounded-[2.5rem] p-16 bg-slate-50">
                        <input type="file" class="hidden" @change="handleFileUpload">
                        <p class="text-xl font-black">é»æ“Šä¸Šå‚³è¨­è¨ˆç¨¿</p>
                        <p class="text-xs text-slate-400 mt-2">AI, PDF, ZIP / MAX 10MB</p>
                    </label>
                </div>

                <div x-show="uploadStep === 'done'" class="text-center py-12" x-cloak>
                    <div class="text-4xl text-emerald-500 mb-4">âœ“</div>
                    <h3 class="text-2xl font-black">æª”æ¡ˆå·²æˆåŠŸé€£çµ</h3>
                </div>
            </div>
        </section>
    </main>

    <div x-show="showSuccess" class="fixed inset-0 bg-slate-900/95 backdrop-blur-3xl flex items-center justify-center z-50 p-6" x-cloak>
        <div class="bg-white rounded-[4rem] p-12 max-w-2xl w-full text-center">
            <h3 class="text-3xl font-black mb-4">æ­£å¼å ±åƒ¹å–®å·²å®Œæˆå»ºç«‹</h3>
            <p class="text-[#C5A059] font-black text-xl mb-8">ç·¨è™Ÿï¼š<span x-text="quoteNumber"></span></p>
            <p class="mb-12 font-bold">PDF å·²å¯„é€è‡³æ‚¨çš„é›»å­ä¿¡ç®±ã€‚</p>
            <button @click="showSuccess = false; $nextTick(() => document.getElementById('upload-section').scrollIntoView({behavior:'smooth'}))" class="w-full bg-slate-900 text-white py-6 rounded-[2rem] font-black">å‰å¾€æª”æ¡ˆä¸Šå‚³å€</button>
        </div>
    </div>

    <script>
        function quoteSystem() {
            return {
                selectedStageId: 'growth',
                selectedPlanId: 'C',
                selectedPlan: {},
                selectedMaterial: { name: 'å°¼é¾ï¼ˆæœ‰ç·šï¼‰', surcharge: 1.2, type: 'æœ‰ç·š' },
                quantity: 4500,
                showForm: false,
                loading: false,
                showSuccess: false,
                quoteNumber: '',
                formData: { company: '', name: '', email: '', contact: '' },
                uploadStep: 'email',
                uploadEmail: '',
                otpInput: '',
                isVerifying: false,
                isUploading: false,
                uploadToken: '',
                // æ³¨æ„ï¼šéƒ¨ç½²å¾Œè«‹è¨˜å¾—æ›´æ–°é€™è£¡çš„ gasUrl
                gasUrl: 'https://script.google.com/macros/s/AKfycbzAQ4XA5e1I2rCBjX9x7XEjA6m2qB8egcRUtFm_j_Vb3N2iQ5lm2FhhK_O--Xur_c-5/exec', 

                stages: [
                    { id: 'startup', name: 'æ–°å‰µæ¸¬è©¦å¸‚å ´', icon: 'ğŸš€', desc: 'ä½èµ·è¨‚é‡å¿«é€Ÿæ‰“æ¨£ã€‚' },
                    { id: 'growth', name: 'æˆé•·æ“´å¼µ', icon: 'ğŸ“ˆ', desc: 'æœ€ä½³è³ªæ„Ÿèˆ‡è¦æ¨¡æ•ˆç›Šå¹³è¡¡é»ã€‚', recommended: true },
                    { id: 'enterprise', name: 'ä¼æ¥­æ¡è³¼', icon: 'ğŸ¢', desc: 'æ¥µè‡´é‡ç”¢èˆ‡é€šè·¯æ¨™é…ã€‚' }
                ],
                allPlans: [
                    { id: 'A', name: 'å–®åŒ…åŸºæœ¬', base: 5.63, moq: 550, canBox: false },
                    { id: 'B', name: 'å–®åŒ…é€²éš', base: 5.63, moq: 550, canBox: false },
                    { id: 'C', name: 'ç›’è£åŸºæœ¬', base: 3.00, moq: 4500, canBox: true },
                    { id: 'D', name: 'ç›’è£é€²éš', base: 2.80, moq: 15000, canBox: true },
                    { id: 'E', name: 'å®¢è£½è¦æ ¼', base: 0, moq: 'å°ˆæ¡ˆè©•ä¼°', canBox: true }
                ],
                materials: [
                    { name: 'å°¼é¾ï¼ˆæœ‰ç·šï¼‰', surcharge: 1.2, type: 'æœ‰ç·š' },
                    { name: 'ç‰ç±³çº–ç¶­ï¼ˆæœ‰ç·šï¼‰', surcharge: 1.2, type: 'æœ‰ç·š' },
                    { name: 'ä¸ç¹”å¸ƒï¼ˆæœ‰ç·šï¼‰', surcharge: 1.2, type: 'æœ‰ç·š' },
                    { name: 'å°¼é¾ï¼ˆç„¡ç·šï¼‰', surcharge: 1.0, type: 'ç„¡ç·š' },
                    { name: 'ä¸ç¹”å¸ƒï¼ˆç„¡ç·šï¼‰', surcharge: 0.7, type: 'ç„¡ç·š' }
                ],
                qtyOptions: [500, 550, 1000, 2000, 4500, 10000, 20000],

                init() { this.selectPlan(this.allPlans[2]); },
                selectStage(stage) {
                    this.selectedStageId = stage.id;
                    if (stage.id === 'startup') this.selectPlan(this.allPlans[0]);
                    if (stage.id === 'growth') this.selectPlan(this.allPlans[2]);
                    if (stage.id === 'enterprise') this.selectPlan(this.allPlans[3]);
                },
                selectPlan(plan) {
                    this.selectedPlanId = plan.id;
                    this.selectedPlan = plan;
                    if (typeof plan.moq === 'number' && this.quantity < plan.moq) this.quantity = plan.moq;
                },
                getPlanBg(planId) {
                    const map = { 'A': 'bg-[#7F1D1D] text-white', 'B': 'bg-[#7C2D12] text-white', 'C': 'bg-[#FACC15] text-[#1A302B]', 'D': 'bg-[#064E3B] text-white' };
                    return map[planId] || 'bg-slate-100';
                },
                getMatBg(type) { return type === 'æœ‰ç·š' ? 'bg-[#ECFDF5] border-[#059669]' : 'bg-[#FFF7ED] border-[#EA580C]'; },
                get canBox() { return this.selectedPlan.canBox; },
                get boxName() { return this.selectedPlanId === 'D' ? 'é€²éšæ–¹æ¡ˆï¼šä¸Šæ€ç›’ M' : 'æ¨™æº–æ–¹æ¡ˆï¼šä¸Šæ€ç›’'; },
                get minMoq() { return typeof this.selectedPlan.moq === 'number' ? this.selectedPlan.moq : 0; },
                get lowMoqSurcharge() {
                    if (this.quantity >= 2000) return 0;
                    return (this.quantity >= 1000) ? 0.3 : 0.8;
                },
                get finalUnitPrice() {
                    if (this.selectedPlanId === 'E') return "æ´½è©¢é¡§å•";
                    let total = this.selectedPlan.base + this.selectedMaterial.surcharge + this.lowMoqSurcharge;
                    if (this.quantity >= 20000) total *= 0.8;
                    else if (this.quantity >= 10000) total *= 0.9;
                    return total.toFixed(2);
                },
                get totalPrice() {
                    if (this.selectedPlanId === 'E') return 0;
                    let product = Math.round(parseFloat(this.finalUnitPrice) * this.quantity);
                    let fees = this.canBox ? 825 : 0;
                    return product + fees;
                },

                // ã€ä¿®æ­£ç‰ˆã€‘æäº¤å ±åƒ¹
                async handleSubmit() {
                    this.loading = true;
                    try {
                        // 1. å–å¾— reCAPTCHA
                        const recaptchaToken = await new Promise((resolve) => {
                            grecaptcha.ready(() => {
                                grecaptcha.execute('6LcivkQsAAAAAHwFJqqT6KHphabDFuYsm2d8t915', {action: 'submit'}).then(resolve);
                            });
                        });

                        const now = new Date();
                        const randomId = Math.random().toString(36).substring(2, 7).toUpperCase();
                        this.quoteNumber = `QT-${now.getFullYear()}${String(now.getMonth()+1).padStart(2,'0')}-${randomId}`;
                        this.uploadEmail = this.formData.email;

                        // 2. åš´æ ¼æ§‹é€  Payload
                        const payload = {
                            action: 'saveQuote',
                            recaptchaToken: recaptchaToken,
                            quoteNumber: this.quoteNumber,
                            customer: {
                                company: this.formData.company,
                                name: this.formData.name,
                                email: this.formData.email,
                                contact: this.formData.contact
                            },
                            params: {
                                planId: this.selectedPlanId,
                                materialName: this.selectedMaterial.name,
                                quantity: parseInt(this.quantity)
                            }
                        };

                        // 3. ç™¼é€è«‹æ±‚
                        const res = await fetch(this.gasUrl, {
                            method: 'POST',
                            body: JSON.stringify(payload)
                        });
                        const result = await res.json();
                        
                        if (result.success) {
                            this.showSuccess = true;
                            this.showForm = false;
                        } else {
                            alert('æäº¤å¤±æ•—ï¼š' + result.msg);
                        }
                    } catch (e) {
                        alert('ç¶²è·¯é€£ç·šç•°å¸¸ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                    } finally {
                        this.loading = false;
                    }
                },

                // å…¶é¤˜æª”æ¡ˆä¸Šå‚³é‚è¼¯... (çœç•¥ï¼Œè«‹ä¿æŒåŸæœ¬çš„ Alpine é‚è¼¯)
                async sendOTP() {
                    if (!this.uploadEmail || !this.quoteNumber) return alert('è«‹å¡«å¯«å®Œæ•´');
                    this.isVerifying = true;
                    try {
                        const res = await fetch(this.gasUrl, { method: 'POST', body: JSON.stringify({ action: 'sendOTP', email: this.uploadEmail, quoteNumber: this.quoteNumber }) });
                        const data = await res.json();
                        if (data.success) { this.uploadStep = 'otp'; } else { alert(data.msg); }
                    } catch (e) { alert('ç™¼é€å¤±æ•—'); } finally { this.isVerifying = false; }
                },
                async verifyOTP() {
                    this.isVerifying = true;
                    try {
                        const res = await fetch(this.gasUrl, { method: 'POST', body: JSON.stringify({ action: 'verifyOTP', email: this.uploadEmail, otp: this.otpInput }) });
                        const data = await res.json();
                        if (data.success) { this.uploadToken = data.token; this.uploadStep = 'upload'; } else { alert('é©—è­‰ç¢¼éŒ¯èª¤'); }
                    } catch (e) { alert('é©—è­‰å¤±æ•—'); } finally { this.isVerifying = false; }
                },
                async handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    this.isUploading = true;
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = async () => {
                        try {
                            const res = await fetch(this.gasUrl, { method: 'POST', body: JSON.stringify({ action: 'uploadFile', quoteNumber: this.quoteNumber, token: this.uploadToken, fileName: file.name, fileData: reader.result }) });
                            const data = await res.json();
                            if (data.success) { this.uploadStep = 'done'; } else { alert(data.msg); }
                        } catch (e) { alert('ä¸Šå‚³å¤±æ•—'); } finally { this.isUploading = false; }
                    };
                }
            }
        }
    </script>
</body>
</html>